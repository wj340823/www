package com.sucsoft.gzhbyjwz.controller;

import javax.servlet.http.HttpServletRequest;

import com.cgs.sscf.commons.exception.BadRequest;
import com.sucsoft.gzhbyjwz.service.risksource.RiskScreeningService;
import com.sucsoft.gzhbyjwz.service.user.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.sucsoft.gzhbyjwz.bean.common.ResultBean;
import com.sucsoft.gzhbyjwz.service.risksource.RiskImportService;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;

@RestController
@RequestMapping("/riskImport")
@Api(value="RiskImportController",description="风险源导入模块")
public class RiskImportController {

	@Autowired
	private RiskImportService riskImportService;

	@Autowired
	private RiskScreeningService riskScreeningService;

	@Autowired
	private UserService userService;
	
//    @ApiOperation(value = "风险源EXCEL导入",httpMethod = "POST",notes = "风险源EXCEL导入")
    @RequestMapping(value = "/addExcel",method = RequestMethod.POST)
    public ResultBean addExcel(HttpServletRequest request, MultipartFile file) throws Exception{

//        if (!userService.isAdmin()){
//            throw  new BadRequest("无导入权限");
//        }
        return riskImportService.addExcel(request,file);
    }

    @RequestMapping(value = "/addExcelByName",method = RequestMethod.POST)
    public ResultBean addExcelByName(HttpServletRequest request, MultipartFile file,String tableName) throws Exception{

//        if (!userService.isAdmin()){
//            throw  new BadRequest("无导入权限");
//        }
        return riskImportService.addExcelByName(request,file,tableName);
    }

    @RequestMapping(value = "/addSheet",method = RequestMethod.POST)
    public ResultBean addSheet(@RequestParam Integer sheetNo,@RequestParam String companyId, MultipartFile file) throws Exception{
        if (!riskImportService.checkSheetNo(sheetNo)){
            return new ResultBean(1,"sheetNo 错误");
        }
        return riskImportService.addExcel(sheetNo,companyId,file);
    }

    @RequestMapping(value = "/addSheetByName",method = RequestMethod.POST)
    public ResultBean addSheetByName(@RequestParam Integer sheetNo,@RequestParam String tableName,@RequestParam String companyId, MultipartFile file) throws Exception{
        if (!riskImportService.checkSheetNo(sheetNo)){
            return new ResultBean(1,"sheetNo 错误");
        }
        return riskImportService.addSheetByName(sheetNo,getClass().getClassLoader().loadClass(tableName),companyId,file);
    }

    @RequestMapping(value = "/addExcels",method = RequestMethod.POST)
    public ResultBean addExcels(HttpServletRequest request, MultipartFile[] files) throws Exception{

        return riskImportService.addExcels(request,files);
    }

    @RequestMapping(value = "/addExcelFromLocal",method = RequestMethod.GET)
    public ResultBean addExcelFromLocal() throws Exception{

        return riskScreeningService.addExcelFromLocal();
    }

    @RequestMapping(value = "/addPlanAttachmentList",method = RequestMethod.GET)
    public ResultBean addPlanAttachmentList(String path) throws Exception{

        return riskScreeningService.addPlanAttachmentList(path);
    }

    @RequestMapping(value = "/updatePrePlan",method = RequestMethod.POST)
    public void updatePrePlan(String path) throws Exception {
        riskImportService.updatePrePlan(path);
    }
}
