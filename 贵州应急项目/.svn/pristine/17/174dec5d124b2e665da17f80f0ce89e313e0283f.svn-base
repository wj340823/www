package com.sucsoft.gzhbyjwz.service.manual;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.cgs.dc.starter.model.GetOptions;
import com.sucsoft.gzhbyjwz.bean.common.Page;
import com.sucsoft.gzhbyjwz.bean.dc12.LawsRegulationsType;
import com.sucsoft.gzhbyjwz.service.common.BasicQueryService;
import com.sucsoft.gzhbyjwz.util.JdbcConn;

@Service
public class EmergencyManualService {
	
	@Autowired
	private BasicQueryService basicQueryService;
	@Autowired
	private JdbcConn jdbcConn;
	
	@Value("${manualFilePath}")
	private String filePath;

	@Transactional
	public List<LawsRegulationsType> getLawsType() {
		List<LawsRegulationsType> lawsType = basicQueryService.getCrudService().list(LawsRegulationsType.class.getName(), new GetOptions(), LawsRegulationsType.class);
		return lawsType;
	}

	@Transactional
	public Page<Map> getLaws(String lawsType,String name,Integer pageNo,Integer pageSize) throws Exception {
		Map<String,Object> params = new HashMap<String,Object>();
		if(StringUtils.isNotBlank(lawsType)){
			params.put("lawsType", lawsType);
		}
		if(StringUtils.isNotBlank(name)){
			params.put("name", "%"+name+"%");
		}
		Page<Map> page = basicQueryService.queryForPage("getLaws", params, Map.class, pageNo, pageSize);
		return page;
	}

	@Transactional
	public String downLoadFile(String fileName, HttpServletRequest request, HttpServletResponse response) throws UnsupportedEncodingException {		
		return jdbcConn.downLoadFile(filePath, fileName, request, response);
	}
}
