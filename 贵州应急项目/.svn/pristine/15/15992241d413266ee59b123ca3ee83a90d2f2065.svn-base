package com.sucsoft.gzhbyjwz.service.risksource;

import com.cgs.dc.PojoDataset;
import com.sucsoft.gzhbyjwz.bean.common.Page;
import com.sucsoft.gzhbyjwz.bean.dc12.HjRiskSubstances;
import com.sucsoft.gzhbyjwz.bean.dc12.QyScenarioAnalysis;
import com.sucsoft.gzhbyjwz.bean.dc12.RiskFactors;
import com.sucsoft.gzhbyjwz.bean.dc12.RiskReceptor;
import com.sucsoft.gzhbyjwz.service.common.BasicQueryService;
import org.apache.commons.lang.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.*;

/**
 * @author wangy
 */
@Service
public class RiskSourceTwoService {

    @Autowired
    private BasicQueryService basicQueryService;

    @Autowired
    private PojoDataset ds;

    /**
     * 增加环境风险物质
     * @param hjRiskSubstances
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean addHjRiskSubstances(HjRiskSubstances hjRiskSubstances){
       try {
           ds.save(hjRiskSubstances,HjRiskSubstances.class.getName());
       }catch (Exception e){
           return false;
       }
        return  true;
    }

    /**
     * 删除环境风险物质
     *
     * @param id
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean deleteHjRiskSubstances(String id) {
        try {
            ds.remove(id, HjRiskSubstances.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 更新环境风险物质
     *
     * @param hjRiskSubstances
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean updateHjRiskSubstances(HjRiskSubstances hjRiskSubstances) {
        try {
            ds.update(hjRiskSubstances,HjRiskSubstances.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 查询环境风险物质
     * @param qyId
     * @return
     */
    public Page getHjRiskSubstances(String qyId,Integer pageNo,Integer pageSize) throws Exception {
        Map<String,Object> params = new HashMap<>();
        if(StringUtils.isNotBlank(qyId)){
            params.put("qyId", qyId);
        }
        Page page = basicQueryService.queryForPage("getHjRiskSubstances",params,HjRiskSubstances.class,pageNo,pageSize);
        return page;
    }

    /**
     * 增加环境风险受体
     * @param riskReceptor
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean addRiskReceptor(RiskReceptor riskReceptor){
        try {
            ds.save(riskReceptor,RiskReceptor.class.getName());
        }catch (Exception e){
            return false;
        }
        return  true;
    }

    /**
     * 删除环境风险受体
     *
     * @param id
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean deleteRiskReceptor(String id) {
        try {
            ds.remove(id, RiskReceptor.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 更新环境风险受体
     *
     * @param riskReceptor
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean updateRiskReceptor(RiskReceptor riskReceptor) {
        try {
            ds.update(riskReceptor,RiskReceptor.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 查询环境风险受体
     * @param qyId
     * @return
     */
    public Page getRiskReceptor(String qyId,Integer pageNo,Integer pageSize) throws Exception {
        Map<String,Object> params = new HashMap<>();
        if(StringUtils.isNotBlank(qyId)){
            params.put("qyId", qyId);
        }
        Page page = basicQueryService.queryForPage("getRiskReceptor",params,RiskReceptor.class,pageNo,pageSize);
        return page;
    }

    /**
     * 增加突发环境事件情景分析
     * @param qyScenarioAnalysis
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean addQyScenarioAnalysis(QyScenarioAnalysis qyScenarioAnalysis){
        try {
            ds.save(qyScenarioAnalysis,QyScenarioAnalysis.class.getName());
        }catch (Exception e){
            return false;
        }
        return  true;
    }

    /**
     * 删除突发环境事件情景分析
     *
     * @param id
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean deleteQyScenarioAnalysis(String id) {
        try {
            ds.remove(id, QyScenarioAnalysis.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 更新突发环境事件情景分析
     *
     * @param qyScenarioAnalysis
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean updateQyScenarioAnalysis(QyScenarioAnalysis qyScenarioAnalysis) {
        try {
            ds.update(qyScenarioAnalysis,QyScenarioAnalysis.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 查询突发环境事件情景分析
     * @param qyId
     * @return
     */
    public Page getQyScenarioAnalysis(String qyId,Integer pageNo,Integer pageSize) throws Exception {
        Map<String,Object> params = new HashMap<>();
        if(StringUtils.isNotBlank(qyId)){
            params.put("qyId", qyId);
        }
        Page page = basicQueryService.queryForPage("getQyScenarioAnalysis",params,QyScenarioAnalysis.class,pageNo,pageSize);
        return page;
    }

    /**
     * 更新环境风险要素
     *
     * @param riskFactors
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean updateRiskFactors(RiskFactors riskFactors) {
        try {
            ds.update(riskFactors,RiskFactors.class.getName());
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

    /**
     * 查询环境风险要素
     * @param qyId
     * @return
     */
    public List<RiskFactors> getRiskFactors(String qyId) throws Exception {
        Map<String,Object> params = new HashMap<>();
        if(StringUtils.isNotBlank(qyId)){
            params.put("qyId", qyId);
        }
        List<RiskFactors> list = basicQueryService.queryForList("getRiskFactors",params,RiskFactors.class,0,0);
        return list;
    }

    /**
     * 企业环境风险要素初始化
     *
     * @param
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean initRiskFactors() {
        try {
            List<Map> list = basicQueryService.queryForList("listRiskSouce", new HashMap<>(), Map.class, 0, 0);

            for (Map map: list) {
                RiskFactors riskFactors = new RiskFactors();
                riskFactors.setRiskfactors_Id(UUID.randomUUID().toString().replaceAll("-", ""));
                riskFactors.setQyId(map.get("COMPANYID").toString());
                riskFactors.setIsJzsyysyd("0");
                riskFactors.setIsTfsj("0");
                riskFactors.setIsWkk("0");
                riskFactors.setIsWxhxp("0");
                riskFactors.setIsYdyhqt("0");
                riskFactors.setIsYjyh("0");
                riskFactors.setIsZjs("0");
                riskFactors.setIsWxfw("0");
                riskFactors.setTime(new Date());

                ds.update(riskFactors,RiskFactors.class.getName());
            }
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
        return true;
    }

}


