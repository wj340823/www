package com.sucsoft.gzhbyjwz.controller;

import com.sucsoft.gzhbyjwz.bean.common.Page;
import com.sucsoft.gzhbyjwz.bean.dc12.ExampleAttachement;
import com.sucsoft.gzhbyjwz.bean.dc12.PlanAttachment;
import com.sucsoft.gzhbyjwz.bean.param.ExampleParam;
import com.sucsoft.gzhbyjwz.service.EmergencyExampleService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/emergencyExample")
@Api(value="ExamController",description="应急案例管理")
public class EmergencyExampleController {

    @Autowired
    private EmergencyExampleService emergencyExampleService;

    @RequestMapping(value="/listEmergencyExample",method= RequestMethod.GET)
    @ApiOperation(httpMethod="GET",value="用条件列表查询应急案例",notes="用条件列表查询应急案例",
            response=List.class,produces= MediaType.TEXT_PLAIN_VALUE)
    public Object listEmergencyExample(ExampleParam exampleParam,Integer pageNo,Integer pageSize) throws Exception{

        return emergencyExampleService.listEmergencyExample(exampleParam,pageNo,pageSize);
    }

    @RequestMapping(value="/listAttachementByExampleId",method= RequestMethod.GET)
    @ApiOperation(httpMethod="GET",value="用条件列表查询案例附件",notes="用条件列表查询案例附件",
            response=List.class,produces= MediaType.TEXT_PLAIN_VALUE)
    public Object listAttachementByExampleId(String exampleId,Integer pageNo,Integer pageSize) throws Exception{

        return emergencyExampleService.listAttachementByExampleId(exampleId,pageNo,pageSize);
    }

    @RequestMapping(value="/addExampleAttachment",method= RequestMethod.POST)
    @ApiOperation(httpMethod="POST",value="添加案例附件",notes="添加案例附件",
            response= Page.class,produces= MediaType.TEXT_PLAIN_VALUE)
    public void addPlanAttachment(@RequestParam MultipartFile file, ExampleAttachement attachment) throws Exception{
        emergencyExampleService.addExampleAttachment(file,attachment);
    }

    @RequestMapping(value="/downExampleAttachment",method= RequestMethod.GET)
    @ApiOperation(httpMethod="GET",value="下载案例附件",notes="下载案例附件",
            response= Page.class,produces= MediaType.TEXT_PLAIN_VALUE)
    public void downPlanAttachment(String attachmentId, HttpServletResponse response, HttpServletRequest request) throws Exception{
        System.out.println(request.getSession().getMaxInactiveInterval());
        emergencyExampleService.downExampleAttachment(attachmentId,response);
    }
}
