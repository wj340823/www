package com.sucsoft.gzhbyjwz.bean.common;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.springframework.util.Assert;

import com.fasterxml.jackson.annotation.JsonIgnore;

public class Page<T> implements Serializable {
	private static final long serialVersionUID = 1L;
	private static int DEFAULT_PAGE_SIZE = 20;
	
	long totalCount = 0;
	int pageNo = 1;
	int pageSize = DEFAULT_PAGE_SIZE;
	List<T> dataList = new ArrayList<T>();

	@JsonIgnore
	private String sql = "";
	@JsonIgnore
	private String hql = "";
	@JsonIgnore
	private String countHql = "";
	@JsonIgnore
	private String countSql = "";	 
	
	public Page(long totalCount, int pageNo, int pageSize, List<T> data) {
		Assert.isTrue(totalCount >= 0, "totalCount must be larger than or euqal with 0");
		Assert.isTrue(pageNo > 0, "pageNo must start from 1");
		Assert.isTrue(pageSize >= 0, "pageSize must be larger than or euqal with 0");
		this.totalCount = totalCount;		
		this.dataList = data;
		this.pageNo = pageNo;
		this.pageSize = pageSize;
		
	} 
	  
	public Page<T> setHql(String hql){
		this.hql = hql;
	    this.countHql = removeOrders(hql);
	    return this;
	}	  
	public Page<T> setSql(String sql) {
		this.sql = sql;
	    this.countSql = removeOrders(sql);
	    return this;
	}
	  
	private String removeOrders(String hql) {
		Pattern p = Pattern.compile("order\\s*by[\\w|\\W|\\s|\\S]*", Pattern.CASE_INSENSITIVE);
		Matcher m = p.matcher(hql);
		StringBuffer sb = new StringBuffer();
		while (m.find()) {
			m.appendReplacement(sb, "");
		}
		m.appendTail(sb);
		return sb.toString();
	}
	  
	public String getHql(){
		return this.hql;
	}	  
	public String getSql() {
	    return this.sql;
	}
	public String getCountHql() {
	    return this.countHql;
	}
	public String getCountSql() {
	    return this.countSql;
	}
	
	public long getTotalCount() {
		return totalCount;
	}

	public void setTotalCount(long totalCount) {
		this.totalCount = totalCount;
	}

	public List<T> getDataList() {
		return dataList;
	}
	public void setDataList(List<T> dataList) {
		this.dataList = dataList;
	}
	public int getTotalPageCount() {
		int totalPageCount = (int) Math.ceil((double)totalCount / this.pageSize);
		return totalPageCount;
	}
	public int getPageNo() {
		return pageNo;
	}
	public int getPageSize() {
		return pageSize;
	}
}