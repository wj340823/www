package com.sucsoft.gzhbyjwz.bean.common.reader;

import net.sf.json.JSONObject;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import java.io.*;
import java.util.Map;

@Component
public class ResourceReader {

    private Logger logger = Logger.getLogger(this.getClass());

    public Map<String, Object> readJsonFromClassPath(String jsonUrl,String encoding) throws IOException{
        return readJson(getClass().getResourceAsStream(jsonUrl),encoding);
    };

    public Map<String, Object> readJson(String jsonUrl,String encoding) throws IOException{
        return readJson(new FileInputStream(jsonUrl),encoding);
    };

    public Map<String, Object> readJson(InputStream is,String encoding) throws IOException {
        StringBuilder sb = new StringBuilder();
        String string = "";
        InputStreamReader reader = null;
        BufferedReader br = null;

        try{
            logger.info("---------读取临时数据---------");
            reader = new InputStreamReader(is,encoding);

            br = new BufferedReader(reader);

            String s = "";
            while((s=br.readLine())!=null){
                sb.append(s);
            }
            string = sb.toString();
            if ( sb.length()>0) {
                logger.info("---------临时数据读取成功---------");
            }
        }finally {
            if (reader != null){
                reader.close();
            }
            if (br != null){
                br.close();
            }
        }
        JSONObject jsonObject = JSONObject.fromObject(string);

        return JSONObject.fromObject(jsonObject);
    }

}
