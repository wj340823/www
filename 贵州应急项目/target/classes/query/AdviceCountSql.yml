---
  grammer: SQL
  queries:
    #根据条件查询物资现状
#    OR g.CATEGORY LIKE :goodsName
#                  OR g.ATTRIBUTE LIKE :goodsName
#                  OR g.PLACE LIKE :goodsName
#                  OR g.SUPPLIER LIKE :goodsName
#                  OR g.EQUIPCODE LIKE :goodsName
    - name: listGoods
      resultType: Map
      statement:
        "
        select
          g.*,w.name as wzkname,w.MANAGEMENTUNIT,w.CONTACTS,w.CONTACTNUMBER,c.NAME as categoryName
        from
          goods g
        LEFT JOIN warehouse w ON w.ID = g.WAREHOUSEID
        LEFT JOIN xzqy x ON x.ID = w.XZQYID
        LEFT JOIN category c ON c.ID = g.CATEGORY
        where
          1=1
        #if($goodsName)
          and (
              g.NAME like :goodsName
              )
        #end
        #if($category)
          and g.CATEGORY =:category
        #end
        #if($min)
          and g.NUMBER > :min
        #end
        #if($max)
          and g.NUMBER < :max
        #end
        #if($managerunit)
          and w.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and x.ID = :xzqy
        #end
        #if($wareHouseId)
          and w.ID = :wareHouseId
        #end
        order by g.unit desc
        "

    #根据条件查询物资现状,统计物资名称
    - name: listGoodsForCount
      resultType: Map
      statement:
        "
        select
          distinct g.name
        from
          goods g
        LEFT JOIN warehouse w ON w.ID = g.WAREHOUSEID
        LEFT JOIN xzqy x ON x.ID = w.XZQYID
        where
          1=1
        #if($goodsName)
          and (
              g.NAME like :goodsName
              OR g.CATEGORY LIKE :goodsName
              OR g.ATTRIBUTE LIKE :goodsName
              OR g.PLACE LIKE :goodsName
              OR g.SUPPLIER LIKE :goodsName
              OR g.EQUIPCODE LIKE :goodsName
              )
        #end
        #if($category)
          and g.CATEGORY =:category
        #end
        #if($min)
          and g.NUMBER > :min
        #end
        #if($max)
          and g.NUMBER < :max
        #end
        #if($managerunit)
          and w.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and x.id = :xzqy
        #end
        #if($wareHouseId)
          and w.ID = :wareHouseId
        #end
        "

    #根据条件查询按行政区域分组统计物资现状
    - name: groupXZQY
      resultType: Map
      statement:
        "
        select
          xzqy.name,COUNT(*) as count
        from
          goods
        LEFT JOIN warehouse ON warehouse.ID = goods.WAREHOUSEID
        LEFT JOIN xzqy ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and goods.NAME like :goodsName
        #end
        #if($category)
          and goods.CATEGORY =:category
        #end
        #if($min)
          and goods.NUMBER > :min
        #end
        #if($max)
          and goods.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        GROUP BY xzqy.name
        "

    #根据条件分月统计物资历史数据
    - name: groupMonth
      resultType: Map
      statement:
        "
        select
          month(h.TIME) as month,AVG(h.NUMBER) as avg
        from
          goodshistory h
        LEFT JOIN warehouse ON warehouse.ID = h.WAREHOUSEID
        LEFT JOIN xzqy  ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and h.NAME like :goodsName
        #end
        #if($category)
          and h.CATEGORY =:category
        #end
        #if($min)
          and h.NUMBER > :min
        #end
        #if($max)
          and h.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        #if($start)
          and h.TIME > :start
        #end
        #if($end)
          and h.TIME < :end
        #end
        GROUP BY month
        "

    #按名称分组统计
    - name: groupName
      resultType: Map
      statement:
        "
        select
          h.NAME as name,AVG(h.NUMBER) as avg
        from
          goodshistory h
        LEFT JOIN warehouse ON warehouse.ID = h.WAREHOUSEID
        LEFT JOIN xzqy  ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and h.NAME like :goodsName
        #end
        #if($category)
          and h.CATEGORY =:category
        #end
        #if($min)
          and h.NUMBER > :min
        #end
        #if($max)
          and h.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        #if($start)
          and h.TIME > :start
        #end
        #if($end)
          and h.TIME < :end
        #end
        GROUP BY h.NAME
        "

    #按类型分组统计物资现状
    - name: groupCategory
      resultType: Map
      statement:
        "
        select
          g.CATEGORY as category,COUNT(*) as count
        from
          goods g
        LEFT JOIN warehouse ON warehouse.ID = g.WAREHOUSEID
        LEFT JOIN xzqy  ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and g.NAME like :goodsName
        #end
        #if($category)
          and g.CATEGORY =:category
        #end
        #if($min)
          and g.NUMBER > :min
        #end
        #if($max)
          and g.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        #if($start)
          and g.TIME > :start
        #end
        #if($end)
          and g.TIME < :end
        #end
        GROUP BY g.CATEGORY
        "

    #按名称分组统计告警
    - name: alarmByNumber
      resultType: Map
      statement:
        "
        SELECT
          t.*
        FROM
        (
          SELECT
            NAME,
            UNIT,
            sum(NUMBER) number,
            sum(LIMITNUMBER) AS limitnumber
          FROM
            goods
          GROUP BY
            NAME,UNIT
        ) t
        WHERE
          t.number < t.limitnumber
        "

    #按行政区域分组统计消耗
    - name: goodsLogCount
      resultType: Map
      statement:
        "
        select
          xzqy.name,sum(goodslog.NUMBER) as sum
        from
          goodslog
        LEFT JOIN warehouse ON warehouse.ID = goodslog.WAREHOUSEID
        LEFT JOIN xzqy ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and goodslog.NAME like :goodsName
        #end
        #if($category)
          and goodslog.CATEGORY =:category
        #end
        #if($min)
          and goodslog.NUMBER > :min
        #end
        #if($max)
          and goodslog.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        #if($start)
          and goodslog.TIME > :start
        #end
        #if($end)
          and goodslog.TIME < :end
        #end
        #if($type)
          and goodslog.TYPE = :type
        #end
        GROUP BY xzqy.name
        "

    #按行政区域分组统计消耗
    - name: consumeCount
      resultType: Map
      statement:
        "
        select
          goodslog.name,sum(goodslog.NUMBER) as sum
        from
          goodslog
        LEFT JOIN warehouse ON warehouse.ID = goodslog.WAREHOUSEID
        LEFT JOIN xzqy ON xzqy.ID = warehouse.XZQYID
        where
          1=1
        #if($goodsName)
          and goodslog.NAME like :goodsName
        #end
        #if($category)
          and goodslog.CATEGORY =:category
        #end
        #if($min)
          and goodslog.NUMBER > :min
        #end
        #if($max)
          and goodslog.NUMBER < :max
        #end
        #if($managerunit)
          and warehouse.MANAGEMENTUNIT = :managerunit
        #end
        #if($xzqy)
          and xzqy.NAME = :xzqy
        #end
        #if($start)
          and goodslog.TIME > :start
        #end
        #if($end)
          and goodslog.TIME < :end
        #end
        #if($type)
          and goodslog.TYPE = :type
        #end
        GROUP BY goodslog.name
        "
    #根据条件查询仓库
    - name: listWarehouse
      resultType: Map
      statement:
        "
        select
          w.*,xzqy.name as xzqy
        from
          warehouse w
        LEFT JOIN xzqy ON xzqy.ID = w.XZQYID 
        where
          1=1
        #if($xzqyId)
          and w.xzqyid = :xzqyId
        #end
        #if($keyword)
          and w.name like :keyword
        #end
        "

    #根据条件查询仓库
    - name: listFrequency
      resultType: Map
      statement:
        "
        select
          s.FREQUENCY,s.GOODSNAME
        from
          searchfrequency s
        ORDER BY FREQUENCY DESC
        limit 6
        "