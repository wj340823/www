---
  grammer: SQL
  queries:
    #根据条件查询预案列表
    - name: listEnterprisePreplan
      resultType: Map
      statement:
        "
        SELECT
          e.COMPANYID eId,
          e.COMPANYNAME,
          e.RISKGRADE,
          x.NAME,
          p.*
        FROM enterpriseinformation e
        LEFT JOIN enterprisepreplan p ON e.COMPANYID = p.COMPANYID
        LEFT JOIN xzqy x on e.XZQYID = x.ID
        WHERE
          1=1
        #if($xzqyId)
          and e.xzqyid =:xzqyId
        #end
        #if($xzqyIdList)
          and e.xzqyid #qin($xzqyIdList 'xzqyIdList')
        #end
        #if($riskGrade)
          and e.RISKGRADE =:riskGrade
        #end
        #if($notInRecord)
          and (p.ID IS NULL OR p.RECORDSTATUS IS NULL OR p.RECORDSTATUS = 0)
        #end
        #if($recordStatus)
          and p.recordstatus =:recordStatus
        #end
        #if($companyName)
          and e.companyName like :companyName
        #end
        #if($strDate)
          and p.documentYear >=:strDate
        #end
        #if($endDate)
          and p.documentYear < :endDate
        #end
        order by p.updateDate desc
        "
    - name: listEnterpriseInfoPage
      resultType: Map
      statement:
        "
        SELECT
          e.COMPANYID eId,
          e.COMPANYNAME,
          e.RISKGRADE,
          e.SQNAME,
          '有' as YJWZ,
          x.NAME
        FROM
        (select
           a.*,b.name as sqName
         from
           enterpriseinformation a
          left join
           xzqy b
          on a.xzqyid2 = b.id)e
        LEFT JOIN enterprisepreplan p ON e.COMPANYID = p.COMPANYID
        LEFT JOIN xzqy x on e.XZQYID = x.ID
        WHERE
          p.deleted = 0
        #if($xzqyId)
          and e.xzqyid =:xzqyId
        #end
        #if($xzqyIdList)
          and e.xzqyid #qin($xzqyIdList 'xzqyIdList')
        #end
        #if($riskGrade)
          and e.RISKGRADE =:riskGrade
        #end
        #if($notInRecord)
          and (p.ID IS NULL OR p.RECORDSTATUS IS NULL OR p.RECORDSTATUS = 0)
        #end
        #if($recordStatus)
          and p.recordstatus =:recordStatus
        #end
        #if($companyName)
          and e.companyName like :companyName
        #end
        #if($strDate)
          and p.documentYear >=:strDate
        #end
        #if($endDate)
          and p.documentYear < :endDate
        #end
        order by p.updateDate desc
        "
    #根据预案id查询附件列表
    - name: listAttachmentByPlan
      resultType: Map
      statement:
        "
        SELECT
          a.*
        FROM newplanattachment a
        LEFT JOIN enterprisepreplan p ON a.PLANID = p.ID
        WHERE
          1 = 1
        #if($planId)
          and p.ID = :planId
        #end
        "
    #根据预案id查询审核状态列表
    - name: listShztByPlan
      resultType: Map
      statement:
        "
        SELECT
          a.*
        FROM yashb a
        LEFT JOIN enterprisepreplan p ON a.YAID = p.ID
        where
          1 = 1
        #if($planId)
          and p.ID = :planId
        #end
        "
    #根据预案id查询附件列表
    - name: getPreplanByCompanyId
      resultType: Map
      statement:
        "
        SELECT
          p.*,
          e.companyName
        FROM enterprisepreplan p
        LEFT JOIN enterpriseinformation e ON e.COMPANYID = p.COMPANYID
        WHERE
          p.deleted = 0 and e.COMPANYID =:companyId
        "
    - name: listEnterpriseFj
      resultType: Map
      statement:
       "  SELECT
              b.type,COUNT(*) as typeCount from (
         SELECT
          distinct a.type, e.companyname

         FROM
           newPlanAttachment a
          LEFT JOIN
           enterprisepreplan  p on a.planId = p.id
         LEFT JOIN enterpriseinformation e ON e.COMPANYID = p.COMPANYID
         WHERE
           p.deleted = 0
         #if($xzqyId)
           and e.xzqyid =:xzqyId
         #end
         #if($xzqyIdList)
           and e.xzqyid #qin($xzqyIdList 'xzqyIdList')
         #end
         #if($riskGrade)
           and e.RISKGRADE =:riskGrade
         #end
         #if($notInRecord)
           and (p.ID IS NULL OR p.RECORDSTATUS IS NULL OR p.RECORDSTATUS = 0)
         #end
         #if($recordStatus)
           and p.recordstatus =:recordStatus
         #end
         #if($companyName)
           and e.companyName like :companyName
         #end
         #if($strDate)
           and p.documentYear >=:strDate
         #end
         #if($endDate)
           and p.documentYear < :endDate
         #end
        ) b  GROUP BY b.type
       "
    - name: listEnterpriseFj1
      resultType: Map
      statement:
       "
         SELECT
           distinct e.companyname
         FROM
            enterpriseinformation e
          LEFT JOIN
          enterprisepreplan  p ON e.COMPANYID = p.COMPANYID
         LEFT JOIN
          newPlanAttachment a  on a.planId = p.id
         WHERE
           p.deleted = 0
         #if($xzqyId)
           and e.xzqyid =:xzqyId
         #end
         #if($xzqyIdList)
           and e.xzqyid #qin($xzqyIdList 'xzqyIdList')
         #end
         #if($riskGrade)
           and e.RISKGRADE =:riskGrade
         #end
         #if($companyName)
           and e.companyName like :companyName
         #end
         #if($isUpload)
             and a.TYPE = :type
         #end
          #if($noUpload)
             and a.TYPE is  null
          #end
       "
    - name: getBaseInfos
      resultType: Map
      statement:
       "
        SELECT
          x.NAME SZ, x2.NAME QX, e.COMPANYNAME,e.RISKGRADE,e.INDUSTRYCATEGORYCODE,e.INDUSTRYCATEGORYNAME,e.ADDRESS,e.LONGITUDE,e.LATITUDE,e.CUSTODIAN,e.CUSTODIANTELEPHONE,e.BZ,e.YAID,
          r.BEIANNUM,r.UNIT,r.TIME,r.SSLY,r.ISWXHXP,r.ISZJS,r.ISWXFW,r.ISWKK,r.ISYDYHQT,r.SFWYYSY,r.SFSYYSY,r.SFEYYSY
        FROM
          xzqy X,xzqy x2,EnterpriseInformation_ya e,RiskFactors_ya r
        WHERE
          x.id = x2.parentid AND x.level = '2' AND x2.id = e.xzqyid AND e.yaid = r.yaid
          #if($qyid)
            AND x.id = :qyid
          #end
        ORDER BY
          x.sort,x2.name
       "
    - name: getPkdcInfos
      resultType: RiskFactorsPkList_ya
      statement:
        "
          SELECT * FROM RiskFactorsPkList_ya
          WHERE
            #if($yaid)
              yaid = :yaid
            #end
        "
    - name: getCpdcInfos
      resultType: ProductInfo_ya
      statement:
        "
          SELECT * FROM ProductInfo_ya
          WHERE
            #if($yaid)
              yaid = :yaid
            #end
        "
    - name: getWzdcInfos
      resultType: HjRiskSubstances_ya
      statement:
        "
          SELECT * FROM HjRiskSubstances_ya
          WHERE
            #if($yaid)
              yaid = :yaid
            #end
        "
    - name: getFxyByName
      resultType: Map
      statement:
        "
          SELECT COMPANYID FROM EnterpriseInformation
          WHERE
            #if($name)
              companyName = :name
            #end
        "
