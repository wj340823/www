    <HTML>
<HEAD>
<TITLE>SkylineGlobe - Skyline Software Systems, Inc.</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<style type="text/css">
.s10w {font-family:  Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-weight: bold; color: #ffffff; text-decoration: none;}
.s12w {font-family:  Arial, Helvetica, sans-serif; font-size: 15px; font-style: normal; font-weight: bold; color: #ffffff; text-decoration: none;}
.highlight {font-family:  Arial, Helvetica, sans-serif; font-size: 15px; font-style: normal; font-weight: bold; color: #ffff00; text-decoration: none;}
</style>
</HEAD>

<BODY leftmargin="0"  topmargin="0" marginwidth="0" marginheight="0" style="background-color:black;overflow:hidden;" OnLoad="Init()" OnUnload="Exit()" oncontextmenu="return false;" > 
<table border=0 width=100% cellspacing=0 cellpadding=5 class="s10w" >
<tr>
<td class="s12w" align=center>
<a style="cursor:pointer;" onclick="CloseAndExit();"><u><b>Exit Indoor Mode</b></u></a><br />
</td></tr>
<tr ><td style="background-color:333333; " class="s10w" align=left>
Collision Detection<br />
    <input type="radio"  name="collisionRadio" onclick="setCollision()" checked  />On
    <input type="radio"  name="collisionRadio" onclick="setCollision()"  />Off
</td>
</tr>
<tr><td style="background-color:333333" class="s10w" align=center>
    <a style="cursor:pointer;" onmousedown="MoveMode=1;" onmouseup="MoveMode=0;" onmouseout="MoveMode=0;" >^</a><br />
<a style="cursor:pointer;" onmousedown="MoveMode=3;" onmouseup="MoveMode=0;" onmouseout="MoveMode=0;"><<</a> <span style="margin-left:40px"></span>  <a style="cursor:pointer;" onmousedown="MoveMode=4;" onmouseup="MoveMode=0;" onmouseout="MoveMode=0;">>></a><br />
    <a style="cursor:pointer;" onmousedown="MoveMode=2;" onmouseup="MoveMode=0;" onmouseout="MoveMode=0;">v</a><br />
</td></tr>
<tr><td >
<span id="locationList"></span>
<br />
</td></tr>

    <object id="SGWorld" classid="CLSID:3a4f91b0-65a8-11d5-85c1-0001023952c1" style="visibility :hidden;display:none">    </object>

</BODY>

<script type="text/javascript" language="javascript">

var MoveMode;
var FloorAltitude;

var navigationMode;
var IndoorGroup ;

var startPos;
var bFlyTo = false;
var hudControls;

var wasUnderground;
var wasCollision ;
var setUnderground;
var lastID;
var needToStop = false;

//-----------------
// Init
function Init()
{

    var node;

	SGWorld.AttachEvent("OnFrame", OnFrame);
	
    // Attach TerraExplorer events to local functions
    startPos = SGWorld.Navigate.GetPosition();

    document.onselectstart=new Function('return false');
    MoveMode = 0;
    FloorAltitude = 2.0;
    bFirstLocation  = true;
    IndoorGroup = -1;
    lastID = "";


    wasCollision = SGWorld.Command.IsChecked(1140, 0);
    setUnderground = false;

	var labelObjID = GetParamValue("building", "");
    var a = SGWorld.ProjectTree.FindItem("Indoor");
    var itemID = SGWorld.ProjectTree.GetNextItem(a, 11);

    while (itemID > 0) // Find the right group
    {
        if (SGWorld.ProjectTree.GetClientData(itemID, "indoor") == labelObjID)
        {
            IndoorGroup = itemID;
            break;
        }
        itemID = SGWorld.ProjectTree.GetNextItem(itemID, 13);
    }

    if (IndoorGroup != -1)  // Scan all locations
    {
         itemID = SGWorld.ProjectTree.GetNextItem(IndoorGroup, 11);
        while (itemID > 0) 
        {
            var obj = SGWorld.ProjectTree.GetObject(itemID);
            if (obj.ObjectType == 19) // location
            {
                locationList.innerHTML += "<li id=\"" + itemID + "\"  ><a style='cursor:pointer;' onclick=JumpTo(" + itemID + ")><u>" + obj.TreeItem.Name + "</u></a></li>"; 
                if (bFirstLocation)
                    JumpTo(itemID);
                bFirstLocation  = false;
                if (obj.Position.Copy().ToRelative().Altitude < 0)
                    setUnderground = true;
            }
            itemID = SGWorld.ProjectTree.GetNextItem(itemID, 13);
        }
    }
    hudControls = SGWorld.Window.GetControls();
//    SGWorld.Window.ShowControls(hudControls & ~1);
    wasUnderground = SGWorld.Command.IsChecked(1027, 0);
    if (setUnderground == true && wasUnderground == false) // Underground (no transparency)
    {
        SGWorld.Command.Execute(1027, 0);   // Underground mode (by default it changes the terrain opacity to 50%)
        SGWorld.Command.Execute(1060,100);  // Terrain opacity back to 100%
    }   
    SGWorld.Command.Execute(1051, 0);  // Pan navigation mode
    if (wasCollision == false)
        SGWorld.Command.Execute(1140, 0);  // Pan collision on
}
//-----------------
// JumpTo
function JumpTo(itemID) {
    SGWorld.Navigate.JumpTo(SGWorld.ProjectTree.GetTerraObjectID(itemID));
    if (lastID != "")
        document.getElementById(lastID).className = "s10w";

    document.getElementById(itemID).className = "highlight";
    lastID = itemID;
	needToStop = true;
}
//--------------
// setCollision
function setCollision() {

    if (document.all["collisionRadio"][0].checked )
        if (!SGWorld.Command.IsChecked(1140, 0))
            SGWorld.Command.Execute(1140, 0);
    if (document.all["collisionRadio"][1].checked)
        if (SGWorld.Command.IsChecked(1140, 0))
        SGWorld.Command.Execute(1140, 0);
}
//-----------------
// Exit
function Exit()
{

    SGWorld.Navigate.SetPosition(startPos);
        
    SGWorld.Window.ShowControls(hudControls);
    SGWorld.Command.Execute(1049, 0);

    if (wasUnderground != SGWorld.Command.IsChecked(1027, 0))
        SGWorld.Command.Execute(1027, 0);
    if (wasCollision != SGWorld.Command.IsChecked(1140, 0))
        SGWorld.Command.Execute(1140, 0);
}

// OnFrame
var time = new Date();
function OnFrame ()
{
	// after performing JumpTo we need to stop, in order for SGWorld.Navigate.Speed to work
	if(needToStop)
	{
		SGWorld.Navigate.Stop();
		needToStop = false;
	}
	var elapsed = (new Date().getTime() - time.getTime()) / 1000; // in seconds.
	time = new Date();

	var curPos = SGWorld.Navigate.GetPosition(3 /*ATC_TERRAIN_ABSOLUTE */);
	SGWorld.Navigate.Speed = 0;
    if (MoveMode == 1) // forward
		SGWorld.Navigate.Speed = 20;
        //SGWorld.Navigate.SetPosition(curPos.Move(elapsed* 20,curPos.Yaw, curPos.Pitch));
    if (MoveMode == 2) // Backward
		SGWorld.Navigate.Speed = -20;
        //SGWorld.Navigate.SetPosition(curPos.Move(-elapsed * 20, curPos.Yaw, curPos.Pitch));
    if (MoveMode == 3) // Left
    {
        curPos.Yaw -= elapsed*90;
        SGWorld.Navigate.SetPosition(curPos);
    }
    if (MoveMode == 4) // Right
    {
        curPos.Yaw += elapsed*90;
        SGWorld.Navigate.SetPosition(curPos);
    }
	
}

//-----------------
// CloseAndExit
function CloseAndExit()
{
    Exit();
    SGWorld.Window.RemovePopupByCaption("Indoor");
}
//-------------------
//  GetParamValue
function GetParamValue(findParam, defaultValue)
{
    var arr = document.location.href.split("?");
    if (arr.length <= 1) return defaultValue;
    arr = arr[1].split("&");    
    for (var i=0; i < arr.length; i++)
    {
        if (arr[i].indexOf(findParam) == 0 && arr[i].indexOf("=") == findParam.length)
        {
            arr = arr[i].split("=");
            return arr[1];
        }
    }
    return defaultValue;
}  

</script>

</HTML>


<!--Sig:00000040UlnRN7mfMvMPsLmAaHf2ZYmWBGJl0yrmtYKK9oB6F3celWsR488i#1pq51WFzJRpPdVznKhBCiurB.8ADNE5XUJJ-->
